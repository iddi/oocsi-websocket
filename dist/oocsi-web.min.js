var OOCSI=function(){function y(){h("CONNECTING to "+w);k=new WebSocket(w);k.onopen=B;k.onclose=C;k.onmessage=D;k.onerror=E}function B(a){k.readyState===WebSocket.OPEN&&r(t);h("CONNECTED")}function C(a){h("DISCONNECTED")}function D(a){if("ping"!==a.data){try{var c=JSON.parse(a.data);if(c.data.hasOwnProperty("_MESSAGE_ID")&&v.hasOwnProperty(c.data._MESSAGE_ID)){var e=v[c.data._MESSAGE_ID];+new Date<e.expiration&&(delete c.data._MESSAGE_ID,e.fn(c.data));delete v[c.data._MESSAGE_ID]}else void 0!==m[c.recipient]?
m[c.recipient].forEach(d=>{d(c)}):h("no handler for event: "+a.data)}catch(d){h("ERROR: parse exception for event data "+a.data)}h("RESPONSE: "+a.data)}else 0<a.data.length&&k.send(".")}function E(a){z();h("ERROR: "+a)}function p(a){k&&k.readyState!==WebSocket.CONNECTING?a():setTimeout(function(){p(a)},200)}function r(a){k&&k.send(a)&&h("SENT: "+a)}function q(){return k.readyState===WebSocket.OPEN}function x(a,c){q()&&r("sendjson "+a+" "+JSON.stringify(c))}function F(a,c){q()&&A(a,function(e){var d=
{_MESSAGE_ID:e.data._MESSAGE_ID};c(e.data,d);x(e.sender,d)})}function A(a,c){q()&&(r("subscribe "+a),void 0===m[a]&&(m[a]=[]),m[a].push(c))}function G(){q()||k.readyState===WebSocket.CONNECTING||(h("RECONNECTING"),y(),p(function(){for(ch in m)r("subscribe "+ch)}))}function H(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}var w="ws://localhost/ws",t,m={},v={},k,h=function(a){},z=function(){};return{connect:function(a,
c,e){w=a;t=c&&0<c.length?c:"webclient_"+ +new Date;m[t]=[e];y();setInterval(G,1E3)},send:function(a,c){p(function(){x(a,c)})},call:function(a,c,e,d){p(function(){if(q()){var b=H();v[b]={expiration:+new Date+e,fn:d};c._MESSAGE_ID=b;c._MESSAGE_HANDLE=a;r("sendjson "+a+" "+JSON.stringify(c))}})},register:function(a,c){p(function(){F(a,c)})},subscribe:function(a,c){p(function(){A(a,c)})},unsubscribe:function(a){p(function(){q()&&(r("unsubscribe "+a),m[a]=[])})},variable:function(a,c){function e(f){b.forEach(function(l){l(f)})}
function d(f){if(arguments.length&&f!==g){g=f;e(f);let l={};l[c]=g;x(a,l)}return g}var b=[],g;d.subscribe=function(f){b.push(f)};this.subscribe(a,function(f){f.data.hasOwnProperty(c)&&d(f.data[c])});return d},isConnected:function(){return q()},handle:function(){return t},close:function(){p(function(){k&&k.close()})},handlers:function(){return m},logger:function(a){h=a},error:function(a){z=a},heyOOCSI:function(a){var c=a||t,e={};e[c]={};e[c].properties={device_id:t};e[c].location={};e[c].components=
{};var d=e[c].components;h(`Added heyOOCSI device ${c}`);return{add_property:function(b,g){e[c].properties[b]=g},add_location:function(b,g,f){e[c].properties[b]=[g,f]},add_sensor_brick:function(b,g,f,l,n,u){d[b]={};d[b].channel_name=g;d[b].type="sensor";d[b].sensor_type=f;d[b].unit=l;d[b].value=n;d[b].icon=u;h(`Added ${b} to the components list for device ${c}.`)},add_number_brick:function(b,g,f,l,n,u){d[b]={};d[b].channel_name=g;d[b].type="number";d[b].min_max=f;d[b].unit=l;d[b].value=n;d[b].icon=
u;h(`Added ${b} to the components list for device ${c}.`)},add_binary_sensor_brick:function(b,g,f,l,n){d[b]={};d[b].channel_name=g;d[b].type="binary_sensor";d[b].sensor_type=f;d[b].state=l;d[b].icon=n;h(`Added ${b} to the components list for device ${c}.`)},add_switch_brick:function(b,g,f,l,n){d[b]={};d[b].channel_name=g;d[b].type="switch";d[b].sensor_type=f;d[b].state=l;d[b].icon=n;h(`Added ${b} to the components list for device ${c}.`)},add_light_brick:function(b,g,f,l,n,u,I,J){d[b]={};d[b].channel_name=
g;d[b].type="light";d[b].ledType=f;d[b].spectrum=l;d[b].min_max=n;d[b].state=u;d[b].brightness=I;d[b].icon=J;h(`Added ${b} to the components list for device ${c}.`)},submit:function(){OOCSI.send("heyOOCSI!",e)},sayHi:function(){OOCSI.send("heyOOCSI!",e)}}}}}();
